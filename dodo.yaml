include:
  - file: '{{ currentDir }}/base/dodo.yaml'
  - file: '{{ currentDir }}/cloudtools/dodo.yaml'
  - file: '{{ currentDir }}/git/dodo.yaml'
  - file: '{{ currentDir }}/session/dodo.yaml'
  - file: '{{ currentDir }}/ssh/dodo.yaml'
  - file: '{{ currentDir }}/vi/dodo.yaml'
  - file: '{{ currentDir }}/languages/buildbase/dodo.yaml'
  - file: '{{ currentDir }}/languages/golang/dodo.yaml'
  - file: '{{ currentDir }}/languages/ruby/dodo.yaml'

backdrops:
  init:
    image:
      # Make sure to build everything on init
      requires: [dodo/base, dodo/git, dodo/tmux, dodo/vim]
      steps: |
        FROM dodo/base
        RUN apt-get update && apt-get -y install curl
        RUN curl -L -o /bin/docker-compose \
            https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64 \
         && chmod +x /bin/docker-compose
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock'
      - '{{ currentDir }}:/compose'
    working_dir: '/compose'
    script: exec docker-compose up -d --build

  k9s:
    build:
      steps: |
        FROM alpine:3.9
        RUN apk add ca-certificates git bash curl
        RUN wget -O /bin/aws-iam-authenticator https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/linux/amd64/aws-iam-authenticator
        RUN chmod +x /bin/aws-iam-authenticator
        RUN wget -O /tmp/k9s.tar.gz https://github.com/derailed/k9s/releases/download/0.7.6/k9s_0.7.6_Linux_x86_64.tar.gz
        RUN tar -xzf /tmp/k9s.tar.gz -C /bin
    volumes:
      - 'awsconfig:/root/.aws'
      - 'kubeconfig:/root/.kube'
    script: exec k9s "$@"

  psql:
    image:
      steps: |
        FROM alpine:3.9
        RUN apk add --no-cache postgresql-client
    script: exec psql "$@"

  mysql:
    image:
      steps: |
        FROM alpine:3.9
        RUN apk add --no-cache mysql-client
    script: exec mysql "$@"
