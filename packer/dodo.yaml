backdrops:
  packer:
    image:
      name: dodo/packer
      requires: [dodo/base, dodo/languages/python, dodo/languages/ruby]
      context: '{{ currentDir }}'
      dockerfile: '{{ currentDir }}/Dockerfile'
    volumes:
      - 'gpg-data:/data/gpg'
      - 'passwords:/home/dodo/.password-store'
      - '{{ projectRoot }}:/build'
    environment:
      - 'GNUPGHOME=/data/gpg'
    working_dir: '/build/{{ projectPath }}'
    script: exec packer "$@"

  kitchen:
    image:
      name: dodo/packer
      requires: [dodo/base, dodo/languages/python, dodo/languages/ruby]
      context: '{{ currentDir }}'
      dockerfile: '{{ currentDir }}/Dockerfile'
    volumes:
      - 'gpg-data:/data/gpg'
      - 'passwords:/home/dodo/.password-store'
      - '{{ projectRoot }}:/build'
    environment:
      - 'GNUPGHOME=/data/gpg'
    working_dir: '/build/{{ projectPath }}'
    script: exec kitchen "$@"
